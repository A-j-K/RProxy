<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>rproxy: src/rproxy.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>src/rproxy.h</h1>  </div>
</div>
<div class="contents">
<a href="rproxy_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright [2012] [Mandiant, inc]</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00005"></a>00005 <span class="comment"> * you may not use this file except in compliance with the License.</span>
<a name="l00006"></a>00006 <span class="comment"> * You may obtain a copy of the License at</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<a name="l00011"></a>00011 <span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00012"></a>00012 <span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00013"></a>00013 <span class="comment"> * See the License for the specific language governing permissions and</span>
<a name="l00014"></a>00014 <span class="comment"> * limitations under the License.</span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef __RPROXY_H__</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define __RPROXY_H__</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;syslog.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;sys/queue.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;confuse.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;evhtp.h&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="rproxy_8h.html#afe5ad1c40036fe5206c1447f0991f000">00029</a> <span class="preprocessor">#define RPROXY_VERSION &quot;1.0.19&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#if EVHTP_VERSION_MAJOR &lt;= 0</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#if EVHTP_VERSION_MINOR &lt;= 4</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#if EVHTP_VERSION_PATCH &lt; 12</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#error RProxy requires libevhtp v0.4.12 or greater</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="rproxy_8h.html#a3467c3727d611a6ffbe43bd4283d9db8">00041</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg</a>       <a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg_t</a>;
<a name="l00042"></a><a class="code" href="rproxy_8h.html#a86b3470bd811533215ff027ae838dcee">00042</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg</a>    <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a>;
<a name="l00043"></a><a class="code" href="rproxy_8h.html#a661923ec095ec72b113d66dd4c0d2f59">00043</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg</a>        <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg_t</a>;
<a name="l00044"></a><a class="code" href="rproxy_8h.html#a177abdf2a0a9b4f1fc7f55eabd21cca2">00044</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg</a>       <a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg_t</a>;
<a name="l00045"></a><a class="code" href="rproxy_8h.html#a88aa64de25fbada1fa978e0edf558b70">00045</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structx509__ext__cfg.html" title="a configuration structure representing a single x509 extension header.">x509_ext_cfg</a>      <a class="code" href="structx509__ext__cfg.html" title="a configuration structure representing a single x509 extension header.">x509_ext_cfg_t</a>;
<a name="l00046"></a><a class="code" href="rproxy_8h.html#a195682786b5c0bc5d407d4eba3ba66eb">00046</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlogger__cfg.html">logger_cfg</a>        <a class="code" href="structlogger__cfg.html">logger_cfg_t</a>;
<a name="l00047"></a><a class="code" href="rproxy_8h.html#a9789354da1629835bf32087a4d5ac054">00047</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg</a>        <a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a>;
<a name="l00048"></a><a class="code" href="rproxy_8h.html#ad605251ceb43c3f323497ff01a5be905">00048</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a>      <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a>;
<a name="l00049"></a><a class="code" href="rproxy_8h.html#a6fe6262434718b52a7db7d3ec92e37aa">00049</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream</a>        <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a>;
<a name="l00050"></a><a class="code" href="rproxy_8h.html#aca114ae0184d34b4af2082257f76e86d">00050</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrule.html" title="a matched rule container used as the argument for evhtp_set_regex_cb">rule</a>              <a class="code" href="structrule.html" title="a matched rule container used as the argument for evhtp_set_regex_cb">rule_t</a>;
<a name="l00051"></a><a class="code" href="rproxy_8h.html#a367edad9ab2aa35c679c908173b6ebc2">00051</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrequest.html" title="structure which represents a full proxy request">request</a>           <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request_t</a>;
<a name="l00052"></a><a class="code" href="rproxy_8h.html#a3c351548b5f910a8492258627efbd112">00052</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlogger__arg.html">logger_arg</a>        <a class="code" href="structlogger__arg.html">logger_arg_t</a>;
<a name="l00053"></a><a class="code" href="rproxy_8h.html#a13c45646ea33817b53fc755d89aa34fb">00053</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlogger__fns.html" title="logging callback functiosn for open/write/close">logger_fns</a>        <a class="code" href="structlogger__fns.html" title="logging callback functiosn for open/write/close">logger_fns</a>;
<a name="l00054"></a><a class="code" href="rproxy_8h.html#adc96e09917156ee0f66f7497b7dc5a5c">00054</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlogger.html" title="the logging wrapper backend.">logger</a>            <a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a>;
<a name="l00055"></a><a class="code" href="rproxy_8h.html#abf7d43af708a1883ddf23e2d01977b71">00055</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy</a>            <a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="rproxy_8h.html#a8e66fbcb90178888ae93a0a2c6c2f580">00057</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>downstream_q      <a class="code" href="rproxy_8h.html#a8e66fbcb90178888ae93a0a2c6c2f580">downstream_q_t</a>;
<a name="l00058"></a><a class="code" href="rproxy_8h.html#a8a069980729bddba998cec9dcede1aeb">00058</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>pending_request_q <a class="code" href="rproxy_8h.html#a8a069980729bddba998cec9dcede1aeb">pending_request_q_t</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="rproxy_8h.html#a729008a71d39814c44bf03dec6d2f907">00060</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bc" title="a downstream&amp;#39;s connection status.">downstream_status</a>   downstream_status;
<a name="l00061"></a><a class="code" href="rproxy_8h.html#a03a6d566e9cee9576174b510a522d7f4">00061</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66">logger_argtype</a>      logger_argtype;
<a name="l00062"></a><a class="code" href="rproxy_8h.html#a85dad6945a9c32ef5820d3f833fdcdaf">00062</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450" title="supported log output types">logger_type</a>         logger_type;
<a name="l00063"></a><a class="code" href="rproxy_8h.html#af3ed6498046670ee2c46028a86103db5">00063</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2">lb_method</a>           lb_method;
<a name="l00064"></a>00064 
<a name="l00071"></a><a class="code" href="structrewrite__cfg.html">00071</a> <span class="keyword">struct </span><a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg</a> {
<a name="l00072"></a><a class="code" href="structrewrite__cfg.html#abb9fde87c11cf4e15df366c80239ff22">00072</a>     <span class="keywordtype">char</span> * <a class="code" href="structrewrite__cfg.html#abb9fde87c11cf4e15df366c80239ff22">src</a>;                      
<a name="l00073"></a><a class="code" href="structrewrite__cfg.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">00073</a>     <span class="keywordtype">char</span> * <a class="code" href="structrewrite__cfg.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">dst</a>;                      
<a name="l00075"></a>00075     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(<a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg</a>) next;
<a name="l00076"></a>00076 };
<a name="l00077"></a>00077 
<a name="l00081"></a><a class="code" href="structdownstream__cfg.html">00081</a> struct <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg</a> {
<a name="l00082"></a><a class="code" href="structdownstream__cfg.html#a1c2046dcb30a629d6d9f45ff8f403f12">00082</a>     <span class="keywordtype">char</span>   * host;                   
<a name="l00083"></a><a class="code" href="structdownstream__cfg.html#a8e0798404bf2cf5dabb84c5ba9a4f236">00083</a>     uint16_t port;                   
<a name="l00084"></a><a class="code" href="structdownstream__cfg.html#a0ba17441c382732ee4172abce4f7b31c">00084</a>     <span class="keywordtype">int</span>      connections;            
<a name="l00085"></a><a class="code" href="structdownstream__cfg.html#af3df35858d42e83dd83e6e22e7caac82">00085</a>     <span class="keywordtype">int</span>      read_timeout;
<a name="l00086"></a><a class="code" href="structdownstream__cfg.html#a199f91b67127c0be666a283e3e600c56">00086</a>     <span class="keywordtype">int</span>      write_timeout;
<a name="l00087"></a><a class="code" href="structdownstream__cfg.html#a0ed80df2496fcbc0327354585ab1f125">00087</a>     <span class="keywordtype">size_t</span>   high_watermark;         
<a name="l00092"></a><a class="code" href="structdownstream__cfg.html#a450171a30ec4d9554ed6ec278d921d98">00092</a>     <span class="keyword">struct </span>timeval retry_ival;       
<a name="l00094"></a>00094     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(downstream_cfg) next;
<a name="l00095"></a>00095 };
<a name="l00096"></a>00096 
<a name="l00101"></a><a class="code" href="structx509__ext__cfg.html">00101</a> struct <a class="code" href="structx509__ext__cfg.html" title="a configuration structure representing a single x509 extension header.">x509_ext_cfg</a> {
<a name="l00102"></a><a class="code" href="structx509__ext__cfg.html#a5ac083a645d964373f022d03df4849c8">00102</a>     <span class="keywordtype">char</span> * name;                     
<a name="l00103"></a><a class="code" href="structx509__ext__cfg.html#a9c3f04a33eae86c77f54f659c7253558">00103</a>     <span class="keywordtype">char</span> * oid;                      
<a name="l00105"></a>00105     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(x509_ext_cfg) next;
<a name="l00106"></a>00106 };
<a name="l00107"></a>00107 
<a name="l00111"></a><a class="code" href="structheaders__cfg.html">00111</a> struct <a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg</a> {
<a name="l00112"></a><a class="code" href="structheaders__cfg.html#a9cb9c3c8c8cd17d4d433b36ca3fb5f67">00112</a>     <span class="keywordtype">bool</span> x_forwarded_for;
<a name="l00113"></a><a class="code" href="structheaders__cfg.html#aa822cb38caf46268896f5060b1ed9008">00113</a>     <span class="keywordtype">bool</span> x_ssl_subject;
<a name="l00114"></a><a class="code" href="structheaders__cfg.html#a9a9da460b861564c1dfd0b615657da9f">00114</a>     <span class="keywordtype">bool</span> x_ssl_issuer;
<a name="l00115"></a><a class="code" href="structheaders__cfg.html#a4c1b42d200df9029a783514798d7a36c">00115</a>     <span class="keywordtype">bool</span> x_ssl_notbefore;
<a name="l00116"></a><a class="code" href="structheaders__cfg.html#abc329dace115487c203ad74cade458d4">00116</a>     <span class="keywordtype">bool</span> x_ssl_notafter;
<a name="l00117"></a><a class="code" href="structheaders__cfg.html#a2a83e6da0a626c75bb18eefa1e737a37">00117</a>     <span class="keywordtype">bool</span> x_ssl_serial;
<a name="l00118"></a><a class="code" href="structheaders__cfg.html#ad59cd16d8140764efec8bc26efbeea04">00118</a>     <span class="keywordtype">bool</span> x_ssl_cipher;
<a name="l00119"></a><a class="code" href="structheaders__cfg.html#acbffb6270c964792f2deda50c6a29029">00119</a>     <span class="keywordtype">bool</span> x_ssl_certificate;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, x509_ext_cfg) x509_exts;
<a name="l00122"></a>00122 };
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2">00124</a> enum <a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2">lb_method</a> {
<a name="l00125"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a40432361f828d84dd5195fdc12fd78e4">00125</a>     <a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a40432361f828d84dd5195fdc12fd78e4">lb_method_rtt</a> = 0,
<a name="l00126"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a6ebc9e376be995947b3e3ca8b9516bd9">00126</a>     lb_method_rr,
<a name="l00127"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a982a493544cf1147414634353e6350ea">00127</a>     lb_method_rand,
<a name="l00128"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a410f9ee07e613700fbeadd303b3f3aa8">00128</a>     lb_method_most_idle,
<a name="l00129"></a><a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a21b3cbefb406578bda1756376706b7c6">00129</a>     <a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2a21b3cbefb406578bda1756376706b7c6">lb_method_none</a>
<a name="l00130"></a>00130 };
<a name="l00131"></a>00131 
<a name="l00135"></a><a class="code" href="structserver__cfg.html">00135</a> <span class="keyword">struct </span><a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg</a> {
<a name="l00136"></a><a class="code" href="structserver__cfg.html#ad5305485fa5bd09707cbf92b40229fa2">00136</a>     <span class="keywordtype">char</span>    * bind_addr;                      
<a name="l00137"></a><a class="code" href="structserver__cfg.html#ae8b1cb0149127050193a6cba72bd6bd7">00137</a>     uint16_t  bind_port;                      
<a name="l00138"></a><a class="code" href="structserver__cfg.html#a08963f7335eef295237ab460863bc3d5">00138</a>     <span class="keywordtype">int</span>       num_threads;                    
<a name="l00139"></a><a class="code" href="structserver__cfg.html#af3df35858d42e83dd83e6e22e7caac82">00139</a>     <span class="keywordtype">int</span>       read_timeout;                   
<a name="l00140"></a><a class="code" href="structserver__cfg.html#a199f91b67127c0be666a283e3e600c56">00140</a>     <span class="keywordtype">int</span>       write_timeout;                  
<a name="l00141"></a><a class="code" href="structserver__cfg.html#a2312059dfa017ada5f47759a0a4bed85">00141</a>     <span class="keywordtype">int</span>       pending_timeout;                
<a name="l00142"></a><a class="code" href="structserver__cfg.html#a63d1d5523c1c9712d7fe73bc936880f2">00142</a>     <span class="keywordtype">int</span>       max_pending;                    
<a name="l00143"></a><a class="code" href="structserver__cfg.html#a9507e1c27beffe02ed97c7b076a42f24">00143</a>     <span class="keywordtype">int</span>       backlog;                        
<a name="l00144"></a><a class="code" href="structserver__cfg.html#aeed9f68829625dc3758a8229ddcdc723">00144</a>     <a class="code" href="rproxy_8h.html#ae06c2db19d7b00358e1ccda2572911b2">lb_method</a> lbalance_method;                
<a name="l00146"></a><a class="code" href="structserver__cfg.html#a8ffd992ec4afb91428a60c8cf21a5ada">00146</a>     evhtp_ssl_cfg_t * ssl;                    
<a name="l00147"></a><a class="code" href="structserver__cfg.html#a2c0f5512474a21988fea5c3fbf38043a">00147</a>     <a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg_t</a>   * headers;                
<a name="l00148"></a><a class="code" href="structserver__cfg.html#aa6c3fcd8e4e2dd2f192e8c376ea9433c">00148</a>     <a class="code" href="structlogger__cfg.html">logger_cfg_t</a>    * <a class="code" href="structlogger.html" title="the logging wrapper backend.">logger</a>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, downstream_cfg) downstreams; 
<a name="l00151"></a>00151     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, <a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg</a>) rewrites;       
<a name="l00153"></a>00153     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(<a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg</a>) next;
<a name="l00154"></a>00154 };
<a name="l00155"></a>00155 
<a name="l00159"></a><a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450">00159</a> enum <a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450" title="supported log output types">logger_type</a> {
<a name="l00160"></a><a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450aaf30047ee9249f1bdbfa6e7fa33488bf">00160</a>     <a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450aaf30047ee9249f1bdbfa6e7fa33488bf">logger_type_file</a> = 0,
<a name="l00161"></a><a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450a58d729428c2d469c6ba5c13297136dd2">00161</a>     logger_type_syslog,
<a name="l00162"></a><a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450a5975c15327c1466e7b75d2291b27f6c7">00162</a>     <a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450a5975c15327c1466e7b75d2291b27f6c7">logger_type_fd</a>
<a name="l00163"></a>00163 };
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="structlogger__cfg.html">00165</a> <span class="keyword">struct </span><a class="code" href="structlogger__cfg.html">logger_cfg</a> {
<a name="l00166"></a><a class="code" href="structlogger__cfg.html#af3eafa4a19c5e01e76dcbdf76bd51cfd">00166</a>     <a class="code" href="rproxy_8h.html#ab4ce26a500093ddcf2c04287f83d1450" title="supported log output types">logger_type</a> <a class="code" href="cfg_8c.html#af3eafa4a19c5e01e76dcbdf76bd51cfd">type</a>;
<a name="l00167"></a><a class="code" href="structlogger__cfg.html#aeac90097f29f7529968697163cea5c18">00167</a>     <span class="keywordtype">char</span>      * filename;
<a name="l00168"></a><a class="code" href="structlogger__cfg.html#a10d8f20808bfba91e5ce0d7bd5cec8cb">00168</a>     <span class="keywordtype">char</span>      * errorlog;
<a name="l00169"></a><a class="code" href="structlogger__cfg.html#a5407a229a5e1a319d75fb29542c83eae">00169</a>     <span class="keywordtype">char</span>      * format;
<a name="l00170"></a><a class="code" href="structlogger__cfg.html#a4f074cb73b7191ef570261fb35b29a8e">00170</a>     <span class="keywordtype">int</span>         syslog_facility;
<a name="l00171"></a>00171 };
<a name="l00172"></a>00172 
<a name="l00176"></a><a class="code" href="structrproxy__cfg.html">00176</a> <span class="keyword">struct </span><a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg</a> {
<a name="l00177"></a><a class="code" href="structrproxy__cfg.html#a9c8772330cb4ae19acb959dd44d023d2">00177</a>     <span class="keywordtype">bool</span>   daemonize;                 
<a name="l00178"></a><a class="code" href="structrproxy__cfg.html#abfa8235e8883ad174cffafa86d96a1c7">00178</a>     <span class="keywordtype">char</span> * rootdir;                   
<a name="l00179"></a><a class="code" href="structrproxy__cfg.html#a14871705f45ccdc5bb9f4549efd8e119">00179</a>     <span class="keywordtype">char</span> * user;                      
<a name="l00180"></a><a class="code" href="structrproxy__cfg.html#a443519726cbe3c4f2b2fe1d42ce2fd2f">00180</a>     <span class="keywordtype">char</span> * group;                     
<a name="l00181"></a><a class="code" href="structrproxy__cfg.html#a2ca9204b8b165d1738155fa755f03352">00181</a>     <span class="keywordtype">int</span>    max_nofile;                
<a name="l00182"></a><a class="code" href="structrproxy__cfg.html#a41780e501833227b7959393c533a46bb">00182</a>     <span class="keywordtype">int</span>    mem_trimsz;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg</a>) servers; 
<a name="l00185"></a>00185 };
<a name="l00186"></a>00186 
<a name="l00190"></a><a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bc">00190</a> enum <a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bc" title="a downstream&amp;#39;s connection status.">downstream_status</a> {
<a name="l00191"></a><a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bcadd8964afff609ef6bd895c95a4b75376">00191</a>     <a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bcadd8964afff609ef6bd895c95a4b75376">downstream_status_nil</a> = 0,        
<a name="l00192"></a><a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bcacc33dff23625c3f107d73ff22eb99001">00192</a>     downstream_status_active,         
<a name="l00193"></a><a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bca047d9c4498f5a71f721a16648dc4eb4c">00193</a>     downstream_status_idle,           
<a name="l00194"></a><a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bca610c1a0e0a444af28aaf1cf0e365a5f0">00194</a>     <a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bca610c1a0e0a444af28aaf1cf0e365a5f0">downstream_status_down</a>            
<a name="l00195"></a>00195 };
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00201"></a><a class="code" href="structdownstream__c.html">00201</a> <span class="keyword">struct </span><a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a> {
<a name="l00202"></a><a class="code" href="structdownstream__c.html#a7173cff9717e6dd36d93c1c3e47db19e">00202</a>     <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a>    * parent;         
<a name="l00203"></a><a class="code" href="structdownstream__c.html#a6721d4f7f0fd837b85e1ce833914843a">00203</a>     evbev_t         * connection;     
<a name="l00204"></a><a class="code" href="structdownstream__c.html#add97c0c26597e458b9761c00d8f11012">00204</a>     <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request_t</a>       * <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request</a>;        
<a name="l00205"></a><a class="code" href="structdownstream__c.html#ad47815735a10bcaef1436eff44e0269d">00205</a>     event_t         * retry_timer;    
<a name="l00206"></a><a class="code" href="structdownstream__c.html#a171c2293ccf26838f4b7ec1f8c93c81c">00206</a>     <a class="code" href="rproxy_8h.html#aad709c2e39c5d950c686f254022c50bc" title="a downstream&amp;#39;s connection status.">downstream_status</a> status;         
<a name="l00207"></a><a class="code" href="structdownstream__c.html#abc953dca5930a67736d6cd8f72353794">00207</a>     <span class="keywordtype">double</span>            rtt;            
<a name="l00208"></a><a class="code" href="structdownstream__c.html#a68db5a0e9447d91b762014b8e7e4583a">00208</a>     uint16_t          sport;          
<a name="l00209"></a><a class="code" href="structdownstream__c.html#af813d5844854e949f07d71ec6f4ed9da">00209</a>     uint8_t           bootstrapped;   
<a name="l00210"></a><a class="code" href="structdownstream__c.html#a51de74dd860dbcdc2ad2263744f2ee43">00210</a>     <span class="keyword">struct </span>timeval    tv_start;       
<a name="l00212"></a>00212     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(<a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a>) next;
<a name="l00213"></a>00213 };
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00219"></a><a class="code" href="structdownstream.html">00219</a> struct <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream</a> {
<a name="l00220"></a><a class="code" href="structdownstream.html#a9435b35210b5d6c2d23fac25ad7e6b2d">00220</a>     <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a> * config;         
<a name="l00221"></a><a class="code" href="structdownstream.html#abc4ce26b166a97e5766105f253a4fe21">00221</a>     evbase_t         * evbase;
<a name="l00222"></a><a class="code" href="structdownstream.html#a7406a1214d69ddae7cc1203dd086853e">00222</a>     <a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a>         * <a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy</a>;
<a name="l00223"></a><a class="code" href="structdownstream.html#ac0b6930107369317501182c334897a65">00223</a>     uint16_t           num_active;     
<a name="l00224"></a><a class="code" href="structdownstream.html#ad1d8984862fb51d00fc6a9338df15ab3">00224</a>     uint16_t           num_idle;       
<a name="l00225"></a><a class="code" href="structdownstream.html#a16f0a9c5421e67180593809eafa8b2eb">00225</a>     uint16_t           num_down;       
<a name="l00227"></a>00227     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a>) active; 
<a name="l00228"></a>00228     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a>) idle;   
<a name="l00229"></a>00229     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(, <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c</a>) down;   
<a name="l00231"></a>00231     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(downstream) next;
<a name="l00232"></a>00232 };
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 
<a name="l00239"></a><a class="code" href="structrule.html">00239</a> struct <a class="code" href="structrule.html" title="a matched rule container used as the argument for evhtp_set_regex_cb">rule</a> {
<a name="l00240"></a><a class="code" href="structrule.html#a7406a1214d69ddae7cc1203dd086853e">00240</a>     <a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a> * rproxy;                  
<a name="l00241"></a><a class="code" href="structrule.html#aa5ebdd520cead17208ba5ecd16de01e7">00241</a>     <span class="keywordtype">char</span>     * regex_from;              
<a name="l00242"></a><a class="code" href="structrule.html#a0102d7175daaad0696c2f5852d5ab031">00242</a>     <span class="keywordtype">char</span>     * regex_to;                
<a name="l00243"></a>00243 };
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="rproxy_8h.html#a0a40bf2849545c822dc896e3c54463aa">00246</a> <span class="preprocessor">#define REQUEST_HAS_ERROR(req) (req-&gt;error ? 1 : req-&gt;upstream_err ? 1 : 0)</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="structrequest.html">00252</a> <span class="keyword">struct </span><a class="code" href="structrequest.html" title="structure which represents a full proxy request">request</a> {
<a name="l00253"></a><a class="code" href="structrequest.html#a7406a1214d69ddae7cc1203dd086853e">00253</a>     <a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a>        * rproxy;           
<a name="l00254"></a><a class="code" href="structrequest.html#ad1fab91fa5ccf6c4a0e4683c463b4e82">00254</a>     evhtp_request_t * upstream_request; 
<a name="l00255"></a><a class="code" href="structrequest.html#af3ea1cd0147dc3e2fadbfb50c2c555bb">00255</a>     <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a>  * downstream_conn;  
<a name="l00256"></a><a class="code" href="structrequest.html#a0b9bdb7dd5bf8b6abc92ec5a6391dc57">00256</a>     <a class="code" href="structrule.html" title="a matched rule container used as the argument for evhtp_set_regex_cb">rule_t</a>          * <a class="code" href="structrule.html" title="a matched rule container used as the argument for evhtp_set_regex_cb">rule</a>;             
<a name="l00257"></a><a class="code" href="structrequest.html#accaeb42c4c926437fc7921fa7910911b">00257</a>     htparser        * parser;           
<a name="l00258"></a><a class="code" href="structrequest.html#a0733a16f50698e953fa054acd0612306">00258</a>     event_t         * pending_ev;       
<a name="l00260"></a><a class="code" href="structrequest.html#adc64ccb7538429fe78e3fe0139267370">00260</a>     uint8_t error;                      
<a name="l00261"></a><a class="code" href="structrequest.html#aceb0c233ba7cc8128f975221ccd7a944">00261</a>     uint8_t upstream_err;               
<a name="l00262"></a><a class="code" href="structrequest.html#a4a3da89cf9b53baa4e27e9b8d2a8491d">00262</a>     uint8_t done;                       
<a name="l00263"></a><a class="code" href="structrequest.html#a1179e649bda19ec966615ff100c5c65c">00263</a>     uint8_t pending;                    
<a name="l00264"></a><a class="code" href="structrequest.html#a113fa498add0bce5bc4f8b31e2858dd6">00264</a>     uint8_t hit_highwm;
<a name="l00265"></a><a class="code" href="structrequest.html#a920e3eec873170a140c71e804eb9a0e2">00265</a>     uint8_t reading;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(<a class="code" href="structrequest.html" title="structure which represents a full proxy request">request</a>) next;
<a name="l00268"></a>00268 };
<a name="l00269"></a>00269 
<a name="l00270"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66">00270</a> enum <a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66">logger_argtype</a> {
<a name="l00271"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a7fcc892f9c7adabfa8ed8edab5822547">00271</a>     <a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a7fcc892f9c7adabfa8ed8edab5822547">logger_argtype_nil</a> = 0,
<a name="l00272"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66aca8393d52654ff64ab530144d5441f1a">00272</a>     logger_argtype_src,
<a name="l00273"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66afb7172474871949878e67367fa4a27dc">00273</a>     logger_argtype_proxy,
<a name="l00274"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66ab4d4c30feb469180c5c4033c0d1efd23">00274</a>     logger_argtype_ts,
<a name="l00275"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66ac631231fdef924b07270ee87a8ee57cb">00275</a>     logger_argtype_ua,
<a name="l00276"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a08710fa7725b9d936d4607e250847a12">00276</a>     logger_argtype_meth,
<a name="l00277"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a64fac8672339a1ad2b9b5f6e20fc749f">00277</a>     logger_argtype_uri,
<a name="l00278"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a2e4d3fc7f63ab7b1bcb5d71349917b48">00278</a>     logger_argtype_proto,
<a name="l00279"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66ade0039fc3d84cb3e561566184d3459cf">00279</a>     logger_argtype_status,
<a name="l00280"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a91cbfc9291bb164bc659c9631a29f2b8">00280</a>     logger_argtype_ref,
<a name="l00281"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a0e9074801e99918570a202ae56522ca1">00281</a>     logger_argtype_host,
<a name="l00282"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a853d850327b799516eed42eb9a2294b4">00282</a>     logger_argtype_ds_sport,
<a name="l00283"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a195d41aaf1fb2c17a5a6268e26ab0f3a">00283</a>     logger_argtype_us_sport,
<a name="l00284"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a81db3b36e60ee1cbf26595c819e89b8f">00284</a>     logger_argtype_us_hdrval,
<a name="l00285"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66ae7267c1b22e69ec39ede652387ecc7c9">00285</a>     logger_argtype_ds_hdrval,
<a name="l00286"></a><a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a281bd3e56df8f9add1e080dbc8d65431">00286</a>     <a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66a281bd3e56df8f9add1e080dbc8d65431">logger_argtype_printable</a>
<a name="l00287"></a>00287 };
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="structlogger__arg.html">00289</a> <span class="keyword">struct </span><a class="code" href="structlogger__arg.html">logger_arg</a> {
<a name="l00290"></a><a class="code" href="structlogger__arg.html#a2c459c32ac251cf89addef46233d326a">00290</a>     <a class="code" href="rproxy_8h.html#aa90180f0bad3194b0b5a175618074f66">logger_argtype</a> <a class="code" href="cfg_8c.html#af3eafa4a19c5e01e76dcbdf76bd51cfd">type</a>;
<a name="l00291"></a><a class="code" href="structlogger__arg.html#a91a70b77df95bd8b0830b49a094c2acb">00291</a>     <span class="keywordtype">char</span>         * data;
<a name="l00292"></a><a class="code" href="structlogger__arg.html#a7360b55975153b822efc5217b7734e6a">00292</a>     <span class="keywordtype">size_t</span>         len;
<a name="l00293"></a><a class="code" href="structlogger__arg.html#ae8cc011bf3ee2d3c19743095ffc0f7a5">00293</a>     <span class="keywordtype">size_t</span>         used;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <a class="code" href="structrewrite__cfg.html#abdca6de9f819fbb180ca735cc61b58ef">TAILQ_ENTRY</a>(<a class="code" href="structlogger__arg.html">logger_arg</a>) next;
<a name="l00296"></a>00296 };
<a name="l00297"></a>00297 
<a name="l00301"></a><a class="code" href="structlogger__fns.html">00301</a> struct <a class="code" href="structlogger__fns.html" title="logging callback functiosn for open/write/close">logger_fns</a> {
<a name="l00302"></a><a class="code" href="structlogger__fns.html#a6df31dcbc07c4ba7571ed97c81b3579b">00302</a>     <span class="keywordtype">void</span> * (* logger_open)(<span class="keywordtype">void</span> *);                
<a name="l00303"></a><a class="code" href="structlogger__fns.html#a271e0e395c9596daa934ac58cd44c973">00303</a>     size_t (* <a class="code" href="logger_8c.html#a47af602baa362077ff981c2c195dab6d">logger_write</a>)(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">void</span> *); 
<a name="l00304"></a><a class="code" href="structlogger__fns.html#aea72f68400a5b949978c081b5b092442">00304</a>     void   (* <a class="code" href="logger_8c.html#aff849e36eaf2015674a4a85adafde4b0">logger_close</a>)(<span class="keywordtype">void</span> *);               
<a name="l00305"></a>00305 };
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00311"></a><a class="code" href="structlogger.html">00311</a> <span class="keyword">struct </span><a class="code" href="structlogger.html" title="the logging wrapper backend.">logger</a> {
<a name="l00312"></a><a class="code" href="structlogger.html#a35ca62177728cbba8c8c474e2d13c25f">00312</a>     <a class="code" href="structlogger__cfg.html">logger_cfg_t</a> * config;
<a name="l00313"></a><a class="code" href="structlogger.html#a8826f1cd00eee643cea5518e152a02f5">00313</a>     <a class="code" href="structlogger__fns.html" title="logging callback functiosn for open/write/close">logger_fns</a>     fns;                            
<a name="l00314"></a><a class="code" href="structlogger.html#a40d1436a44d75e8e72c6d656bbfc0c9a">00314</a>     <span class="keywordtype">void</span>         * fnarg;                          
<a name="l00315"></a><a class="code" href="structlogger.html#a1dfbcbc4195aa10e4d2208fe6b62358b">00315</a>     FILE         * errorlog;                       
<a name="l00317"></a>00317     <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(logger_args, <a class="code" href="structlogger__arg.html">logger_arg</a>) args;      <span class="comment">/* list of arguments to convert to a log string */</span>
<a name="l00318"></a>00318 };
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(downstream_q, downstream);
<a name="l00321"></a>00321 <a class="code" href="rproxy_8h.html#a2b0e0ab70df7df9b0277433256fb8d5b">TAILQ_HEAD</a>(pending_request_q, <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request</a>);
<a name="l00322"></a>00322 
<a name="l00326"></a><a class="code" href="structrproxy.html">00326</a> struct rproxy {
<a name="l00327"></a><a class="code" href="structrproxy.html#ad2f5cc5c9e97f75f1fe923c57af9e875">00327</a>     evhtp_t           * htp;                  
<a name="l00328"></a><a class="code" href="structrproxy.html#abc4ce26b166a97e5766105f253a4fe21">00328</a>     evbase_t          * evbase;               
<a name="l00329"></a><a class="code" href="structrproxy.html#af3ee80b7bbc3efd7e6fd24ecc2763670">00329</a>     event_t           * request_ev;           
<a name="l00330"></a><a class="code" href="structrproxy.html#a9575b06719f9ef5b9443b1dc68d38fe4">00330</a>     <a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a>          * <a class="code" href="structlogger.html" title="the logging wrapper backend.">logger</a>;               
<a name="l00331"></a><a class="code" href="structrproxy.html#a2b2ec0cbdf0031f3a5b605b6ceb3ba4c">00331</a>     <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg_t</a>      * <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg</a>;           
<a name="l00332"></a><a class="code" href="structrproxy.html#a604c067911df3125bf053648b7bd9f16">00332</a>     <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a>      * last_downstream_used; 
<a name="l00333"></a><a class="code" href="structrproxy.html#afb5a1bdc2543295aa64fb307132f2f7f">00333</a>     <a class="code" href="rproxy_8h.html#a8e66fbcb90178888ae93a0a2c6c2f580">downstream_q_t</a>      downstreams;          
<a name="l00334"></a><a class="code" href="structrproxy.html#a4655cc39281df78e96afcd716540ede5">00334</a>     <a class="code" href="rproxy_8h.html#a8a069980729bddba998cec9dcede1aeb">pending_request_q_t</a> pending;              
<a name="l00335"></a><a class="code" href="structrproxy.html#a44f585d3b9dd885ece0f12a341d587a9">00335</a>     <span class="keywordtype">int</span>                 n_pending;            
<a name="l00336"></a>00336 };
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">int</span> <a class="code" href="rproxy_8c.html#ab77454da1d73366614b948b76955ba10">rproxy_init</a>(evbase_t *, <a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a> *);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="comment">/********************************************</span>
<a name="l00341"></a>00341 <span class="comment"> * configuration alloc/parsing functions</span>
<a name="l00342"></a>00342 <span class="comment"> *******************************************/</span>
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <a class="code" href="structlogger__cfg.html">logger_cfg_t</a>     * <a class="code" href="cfg_8c.html#a59c4088f7a1fc6651a66baf728af7c64" title="allocates a new logger_cfg_t resource">logger_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00345"></a>00345 <a class="code" href="structlogger__cfg.html">logger_cfg_t</a>     * <a class="code" href="cfg_8c.html#a4dfd52d27ad3d0cb4aa7192603e24220" title="parses a logger configuration">logger_cfg_parse</a>(cfg_t *);
<a name="l00346"></a>00346 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#a766e3bc4fc5aa14d35554690345bbb02" title="free logger_cfg_t resources">logger_cfg_free</a>(<a class="code" href="structlogger__cfg.html">logger_cfg_t</a> *);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 evhtp_ssl_cfg_t  * <a class="code" href="cfg_8c.html#a847899aac407eedf8e81688a3d7727bc" title="allocate a new ssl configuration resource">ssl_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00349"></a>00349 evhtp_ssl_cfg_t  * <a class="code" href="cfg_8c.html#afd8b59b760df90150714b5efc063ba41" title="parses and creates a new ssl_cfg_t resource">ssl_cfg_parse</a>(cfg_t *);
<a name="l00350"></a>00350 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#af0bd9268f79d6b12d73296190ca0f10c" title="free ssl configuration resources">ssl_cfg_free</a>(evhtp_ssl_cfg_t *);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a> * <a class="code" href="cfg_8c.html#a6e9901c0736e7b8817d5b00ac1103b37">downstream_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00353"></a>00353 <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a> * <a class="code" href="cfg_8c.html#a8b679127205e5c2c8214cec1b5c35282">downstream_cfg_parse</a>(cfg_t *);
<a name="l00354"></a>00354 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#a4dd7752d0e7d57c5e44046a29da36803">downstream_cfg_free</a>(<a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a> *);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg_t</a>    * <a class="code" href="cfg_8c.html#ab41bf5fe2c141baca50e46bceeecd656">rewrite_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00357"></a>00357 <a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg_t</a>    * <a class="code" href="cfg_8c.html#a1d3138f61c8f92e4d532fa01403f707e">rewrite_cfg_parse</a>(cfg_t *);
<a name="l00358"></a>00358 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#ab0f240e84b327352dbaec13d17a8f479">rewrite_cfg_free</a>(<a class="code" href="structrewrite__cfg.html" title="a configuration structure representing a single rewrite rule.">rewrite_cfg_t</a> *);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg_t</a>    * <a class="code" href="cfg_8c.html#a3391d4c984258a88b4e3c2d5debcea60">headers_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00361"></a>00361 <a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg_t</a>    * <a class="code" href="cfg_8c.html#ac8e10b955b001d1e8adc1caf4ab7928f">headers_cfg_parse</a>(cfg_t *);
<a name="l00362"></a>00362 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#afcb50cd29ecd8e61cd871cfcbf22e0c6">headers_cfg_free</a>(<a class="code" href="structheaders__cfg.html" title="which headers to add to the downstream request if avail.">headers_cfg_t</a> *);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg_t</a>     * <a class="code" href="cfg_8c.html#a8cf41b42997cbc89bb0f534665fc1563">server_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00365"></a>00365 <a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg_t</a>     * <a class="code" href="cfg_8c.html#a1afa7d829e27d77c6482b6828d59a0dd">server_cfg_parse</a>(cfg_t *);
<a name="l00366"></a>00366 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#aaecf637fdd9b26cd269a47dc5439a1ff">server_cfg_free</a>(<a class="code" href="structserver__cfg.html" title="configuration for a single listening frontend server.">server_cfg_t</a> *);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a>     * <a class="code" href="cfg_8c.html#aad055bbe629e010bd1d3d465aea7a797">rproxy_cfg_new</a>(<span class="keywordtype">void</span>);
<a name="l00369"></a>00369 <a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a>     * <a class="code" href="cfg_8c.html#a0ffa45af284dec5bb216c158521b85a9">rproxy_cfg_parse</a>(cfg_t *);
<a name="l00370"></a>00370 <a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a>     * <a class="code" href="cfg_8c.html#a3cdb2c9a593264ec84c85edbfc7361ca">rproxy_cfg_parse_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00371"></a>00371 <span class="keywordtype">void</span>               <a class="code" href="cfg_8c.html#a526b092766562db21a7160eb8e12ec13">rproxy_cfg_free</a>(<a class="code" href="structrproxy__cfg.html" title="structure representing the entire rproxy configuration file.">rproxy_cfg_t</a> *);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 <span class="comment">/********************************************</span>
<a name="l00374"></a>00374 <span class="comment">* SSL verification callback functions</span>
<a name="l00375"></a>00375 <span class="comment">********************************************/</span>
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="keywordtype">int</span> <a class="code" href="rproxy_8h.html#ac3e78035b841e9fbd36341d4b20726df">ssl_x509_verifyfn</a>(<span class="keywordtype">int</span>, X509_STORE_CTX *);
<a name="l00378"></a>00378 <span class="keywordtype">int</span> <a class="code" href="rproxy_8h.html#af7d0e5a75aa8b5a3bb4340bd2cb0aa19">ssl_x509_issuedcb</a>(X509_STORE_CTX *, X509 *, X509 *);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="comment">/***********************************************</span>
<a name="l00381"></a>00381 <span class="comment">* Request handling funcs (upstream/downstream)</span>
<a name="l00382"></a>00382 <span class="comment">***********************************************/</span>
<a name="l00383"></a>00383 <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request_t</a> * <a class="code" href="request_8c.html#a9f0b3a2df2a459680a19b1767e73525e">request_new</a>(<a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a> *);
<a name="l00384"></a>00384 <span class="keywordtype">void</span>        <a class="code" href="request_8c.html#a80af8a96d770166f3e55982f0ea394e6">request_free</a>(<a class="code" href="structrequest.html" title="structure which represents a full proxy request">request_t</a> *);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="comment">/***********************************************</span>
<a name="l00387"></a>00387 <span class="comment">* Downstream handling functions</span>
<a name="l00388"></a>00388 <span class="comment">***********************************************/</span>
<a name="l00389"></a>00389 <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a>   * <a class="code" href="downstream_8c.html#af43dc9df06bf91fa47b05dc68c3f1411" title="allocates a downstream_t parent and initializes the downstream connection queues.">downstream_new</a>(<a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a> *, <a class="code" href="structdownstream__cfg.html" title="configuration for a single downstream.">downstream_cfg_t</a> *);
<a name="l00390"></a>00390 <span class="keywordtype">void</span>             <a class="code" href="downstream_8c.html#a35510eba776c5b630b0998cba6c0a16c" title="frees all downstream connections and the parent">downstream_free</a>(<a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a> *);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> * <a class="code" href="downstream_8c.html#ab33dc99814365ac5170ca09db6fa9789" title="creates a new downstream connection using downstream_t information">downstream_connection_new</a>(evbase_t *, <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a> *);
<a name="l00393"></a>00393 <a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> * <a class="code" href="downstream_8c.html#a829c494e614760b9bef9696aa210cd73">downstream_connection_get</a>(<a class="code" href="structrproxy.html" title="the main rproxy_t structure">rproxy_t</a> *);
<a name="l00394"></a>00394 <span class="keywordtype">void</span>             <a class="code" href="downstream_8c.html#aa48a91435539276f239ad75691a5e552" title="frees a downstream connection resource">downstream_connection_free</a>(<a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> *);
<a name="l00395"></a>00395 <span class="keywordtype">int</span>              <a class="code" href="downstream_8c.html#a01dc52dd1fc93603bcedf352c9a9d287" title="initializes downstream connections">downstream_connection_init</a>(evbase_t *, <a class="code" href="structdownstream.html" title="a container active/idle/downed downstream connections">downstream_t</a> *);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="keywordtype">int</span>              <a class="code" href="downstream_8c.html#a8ce1ead74e21489465ea26410493af8d" title="sets a downstream connection to active, signifying it is currently processing another request...">downstream_connection_set_active</a>(<a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> *);
<a name="l00398"></a>00398 <span class="keywordtype">int</span>              <a class="code" href="downstream_8c.html#a29ff5e004ebcb9a07bea61f6d188d0d5" title="sets a downstream connection to idle and ready to be used.">downstream_connection_set_idle</a>(<a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> *);
<a name="l00399"></a>00399 <span class="keywordtype">int</span>              <a class="code" href="downstream_8c.html#a90c4623093050b6cbf489cdb56081897" title="sets a downstream connection down, shutting down sockets and enabling the retry timer process...">downstream_connection_set_down</a>(<a class="code" href="structdownstream__c.html" title="a structure representing a downstream connection.">downstream_c_t</a> *);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="comment">/* downstream socket handling callbacks */</span>
<a name="l00402"></a>00402 <span class="keywordtype">void</span> <a class="code" href="downstream_8c.html#a853c8bede343bb265c27c0426c1f7c8c" title="called when a downstream has either successfully been connect()&amp;#39;d or if an error has occured on t...">downstream_connection_eventcb</a>(evbev_t *, <span class="keywordtype">short</span>, <span class="keywordtype">void</span> *);
<a name="l00403"></a>00403 <span class="keywordtype">void</span> <a class="code" href="downstream_8c.html#ab38cd3fabc18701dfb32185f7cea53c9" title="called when the retry event timer has been triggered and attempts to reconnect to a downstream in a d...">downstream_connection_retry</a>(<span class="keywordtype">int</span>, <span class="keywordtype">short</span>, <span class="keywordtype">void</span> *);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">/***********************************************</span>
<a name="l00406"></a>00406 <span class="comment"> * SSL helper functions.</span>
<a name="l00407"></a>00407 <span class="comment"> ************************************************/</span>
<a name="l00408"></a>00408 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#abf56956bfad7248d23d3842abe02c572">ssl_subject_tostr</a>(evhtp_ssl_t *);
<a name="l00409"></a>00409 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#afa062c61f3cb48fcccd7ebc0148e67de">ssl_issuer_tostr</a>(evhtp_ssl_t *);
<a name="l00410"></a>00410 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#a5bea5108d734667849c89e05eb9c96f2">ssl_notbefore_tostr</a>(evhtp_ssl_t *);
<a name="l00411"></a>00411 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#adffb2264dcece6a27d46576d2e55b436">ssl_notafter_tostr</a>(evhtp_ssl_t *);
<a name="l00412"></a>00412 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#a8601cc6c3162d13b7d301515cf493b1a">ssl_serial_tostr</a>(evhtp_ssl_t *);
<a name="l00413"></a>00413 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#ac49fe50305a1334d55152c2c58090537">ssl_cipher_tostr</a>(evhtp_ssl_t *);
<a name="l00414"></a>00414 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#a3351029fb9198460ca7df93a06a6291f">ssl_cert_tostr</a>(evhtp_ssl_t *);
<a name="l00415"></a>00415 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="rproxy_8h.html#ac3ce5e06d9293fcc25419a5a94d748d2">ssl_x509_ext_tostr</a>(evhtp_ssl_t *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">/***********************************************</span>
<a name="l00418"></a>00418 <span class="comment">* Logger functions</span>
<a name="l00419"></a>00419 <span class="comment">***********************************************/</span>
<a name="l00420"></a>00420 <a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> * <a class="code" href="logger_8c.html#a0c67eb7f83578ca19d285438f843c8a7">logger_init</a>(<a class="code" href="structlogger__cfg.html">logger_cfg_t</a> *);
<a name="l00421"></a>00421 <span class="keywordtype">void</span>       <a class="code" href="logger_8c.html#a48241d76439e6a417a669f987d57b732">logger_log_request</a>(<a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> *, <a class="code" href="structrequest.html" title="structure which represents a full proxy request">request_t</a> *);
<a name="l00422"></a>00422 <span class="keywordtype">void</span>       <a class="code" href="logger_8c.html#aa30e8d68deec42235780583f724cc6a5">logger_log_errorf</a>(<a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> *, <span class="keywordtype">char</span> * fmt, ...);
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="rproxy_8h.html#a7f1317e7be60a559256c9277ed46d0c0">00424</a> <span class="preprocessor">#define logger_log_error(logger, fmt, ...)                  do {                                    \</span>
<a name="l00425"></a>00425 <span class="preprocessor">        time_t t = time(NULL);                                                                      \</span>
<a name="l00426"></a>00426 <span class="preprocessor">        struct tm * dm = localtime(&amp;t);                                                             \</span>
<a name="l00427"></a>00427 <span class="preprocessor">                                                                                                    \</span>
<a name="l00428"></a>00428 <span class="preprocessor">        logger_log_errorf(logger, &quot;[%02d:%02d:%02d] %s:[%d]: &quot; fmt,                                 \</span>
<a name="l00429"></a>00429 <span class="preprocessor">                          dm-&gt;tm_hour, dm-&gt;tm_min, dm-&gt;tm_sec, __FILE__, __LINE__, ## __VA_ARGS__); \</span>
<a name="l00430"></a>00430 <span class="preprocessor">} while (0)</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span>
<a name="l00432"></a><a class="code" href="rproxy_8h.html#ac38d6a2767a36d3eab163c3034fd0952">00432</a> <span class="preprocessor">#define logger_log_request_error(logger, request, fmt, ...) do {                                            \</span>
<a name="l00433"></a>00433 <span class="preprocessor">        time_t t = time(NULL);                                                                              \</span>
<a name="l00434"></a>00434 <span class="preprocessor">        struct tm * dm = localtime(&amp;t);                                                                     \</span>
<a name="l00435"></a>00435 <span class="preprocessor">                                                                                                            \</span>
<a name="l00436"></a>00436 <span class="preprocessor">        logger_log_request_errorf(logger, request, &quot;[%02d:%02d:%02d] %s:[%d]: &quot; fmt,                        \</span>
<a name="l00437"></a>00437 <span class="preprocessor">                                  dm-&gt;tm_hour, dm-&gt;tm_min, dm-&gt;tm_sec, __FILE__, __LINE__, ## __VA_ARGS__); \</span>
<a name="l00438"></a>00438 <span class="preprocessor">} while (0)</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="keywordtype">void</span> * <a class="code" href="logger_8c.html#a1175c0be71fcc00973c2e8fe0e901097">logger_open</a>(<a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> *);
<a name="l00442"></a>00442 <span class="keywordtype">size_t</span> <a class="code" href="logger_8c.html#a47af602baa362077ff981c2c195dab6d">logger_write</a>(<a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00443"></a>00443 <span class="keywordtype">void</span>   <a class="code" href="logger_8c.html#aff849e36eaf2015674a4a85adafde4b0">logger_close</a>(<a class="code" href="structlogger.html" title="the logging wrapper backend.">logger_t</a> *);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 <span class="preprocessor">#endif</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Apr 4 2012 22:55:21 for rproxy by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
