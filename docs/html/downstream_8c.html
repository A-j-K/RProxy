<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>rproxy: src/downstream.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>src/downstream.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;netinet/tcp.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="rproxy_8h_source.html">rproxy.h</a>&quot;</code><br/>

<p><a href="downstream_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a29ff5e004ebcb9a07bea61f6d188d0d5">downstream_connection_set_idle</a> (<a class="el" href="structdownstream__c.html">downstream_c_t</a> *connection)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets a downstream connection to idle and ready to be used.  <a href="#a29ff5e004ebcb9a07bea61f6d188d0d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a90c4623093050b6cbf489cdb56081897">downstream_connection_set_down</a> (<a class="el" href="structdownstream__c.html">downstream_c_t</a> *connection)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets a downstream connection down, shutting down sockets and enabling the retry timer process.  <a href="#a90c4623093050b6cbf489cdb56081897"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a8ce1ead74e21489465ea26410493af8d">downstream_connection_set_active</a> (<a class="el" href="structdownstream__c.html">downstream_c_t</a> *connection)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets a downstream connection to active, signifying it is currently processing another request.  <a href="#a8ce1ead74e21489465ea26410493af8d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a71ede095adeb4536b471f6bdb97954ef">downstream_connection_get_most_idle</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">attempts to find an idle downstream connection with the most idle connections.  <a href="#a71ede095adeb4536b471f6bdb97954ef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#aa251a82efe97edcd17f1e589740e416d">downstream_connection_get_lowest_rtt</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attempts to find an idle downstream connection with the lowest RTT.  <a href="#aa251a82efe97edcd17f1e589740e416d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a75865be458f18b80ff4c06d50972b620">downstream_connection_get_none</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attempts to find the first idle downstream connection available.  <a href="#a75865be458f18b80ff4c06d50972b620"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a244f84554906ebc5e0393b530cf4de5c">downstream_connection_get_rr</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attempts to find an idle connection using round-robin on configured downstreams. It should be noted that if only 1 downstream is configured, this will fallback to using the RTT load-balancing method.  <a href="#a244f84554906ebc5e0393b530cf4de5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a829c494e614760b9bef9696aa210cd73">downstream_connection_get</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a0fbcfda628857d24c557d68ba1ae2b7c">downstream_connection_writecb</a> (evbev_t *bev, void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a853c8bede343bb265c27c0426c1f7c8c">downstream_connection_eventcb</a> (evbev_t *bev, short events, void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">called when a downstream has either successfully been connect()'d or if an error has occured on the socket.  <a href="#a853c8bede343bb265c27c0426c1f7c8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#ae9caabab44d8b22d36dc355c14cfd854">downstream_connection_readcb</a> (evbev_t *bev, void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">called when data becomes available on a downstream socket and deals with the data as a response of a request.  <a href="#ae9caabab44d8b22d36dc355c14cfd854"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#ab38cd3fabc18701dfb32185f7cea53c9">downstream_connection_retry</a> (int sock, short which, void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">called when the retry event timer has been triggered and attempts to reconnect to a downstream in a down state.  <a href="#ab38cd3fabc18701dfb32185f7cea53c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a01dc52dd1fc93603bcedf352c9a9d287">downstream_connection_init</a> (evbase_t *evbase, <a class="el" href="structdownstream.html">downstream_t</a> *<a class="el" href="structdownstream.html">downstream</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initializes downstream connections  <a href="#a01dc52dd1fc93603bcedf352c9a9d287"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#aa48a91435539276f239ad75691a5e552">downstream_connection_free</a> (<a class="el" href="structdownstream__c.html">downstream_c_t</a> *connection)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">frees a downstream connection resource  <a href="#aa48a91435539276f239ad75691a5e552"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#ab33dc99814365ac5170ca09db6fa9789">downstream_connection_new</a> (evbase_t *evbase, <a class="el" href="structdownstream.html">downstream_t</a> *<a class="el" href="structdownstream.html">downstream</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">creates a new downstream connection using downstream_t information  <a href="#ab33dc99814365ac5170ca09db6fa9789"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#a35510eba776c5b630b0998cba6c0a16c">downstream_free</a> (<a class="el" href="structdownstream.html">downstream_t</a> *<a class="el" href="structdownstream.html">downstream</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">frees all downstream connections and the parent  <a href="#a35510eba776c5b630b0998cba6c0a16c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdownstream.html">downstream_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="downstream_8c.html#af43dc9df06bf91fa47b05dc68c3f1411">downstream_new</a> (<a class="el" href="structrproxy.html">rproxy_t</a> *<a class="el" href="structrproxy.html">rproxy</a>, <a class="el" href="structdownstream__cfg.html">downstream_cfg_t</a> *cfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">allocates a downstream_t parent and initializes the downstream connection queues.  <a href="#af43dc9df06bf91fa47b05dc68c3f1411"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a853c8bede343bb265c27c0426c1f7c8c"></a><!-- doxytag: member="downstream.c::downstream_connection_eventcb" ref="a853c8bede343bb265c27c0426c1f7c8c" args="(evbev_t *bev, short events, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_connection_eventcb </td>
          <td>(</td>
          <td class="paramtype">evbev_t *&nbsp;</td>
          <td class="paramname"> <em>bev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>called when a downstream has either successfully been connect()'d or if an error has occured on the socket. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bev</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>events</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00925">925</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa48a91435539276f239ad75691a5e552"></a><!-- doxytag: member="downstream.c::downstream_connection_free" ref="aa48a91435539276f239ad75691a5e552" args="(downstream_c_t *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_connection_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>frees a downstream connection resource </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01258">1258</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a829c494e614760b9bef9696aa210cd73"></a><!-- doxytag: member="downstream.c::downstream_connection_get" ref="a829c494e614760b9bef9696aa210cd73" args="(rproxy_t *rproxy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00846">846</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa251a82efe97edcd17f1e589740e416d"></a><!-- doxytag: member="downstream.c::downstream_connection_get_lowest_rtt" ref="aa251a82efe97edcd17f1e589740e416d" args="(rproxy_t *rproxy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_get_lowest_rtt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Attempts to find an idle downstream connection with the lowest RTT. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rproxy</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a downstream connection on success, NULL if no downstreams are available. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00724">724</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71ede095adeb4536b471f6bdb97954ef"></a><!-- doxytag: member="downstream.c::downstream_connection_get_most_idle" ref="a71ede095adeb4536b471f6bdb97954ef" args="(rproxy_t *rproxy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_get_most_idle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>attempts to find an idle downstream connection with the most idle connections. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rproxy</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a downstream connection, otherwise NULL if no downstreams are avail. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00678">678</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a75865be458f18b80ff4c06d50972b620"></a><!-- doxytag: member="downstream.c::downstream_connection_get_none" ref="a75865be458f18b80ff4c06d50972b620" args="(rproxy_t *rproxy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_get_none </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Attempts to find the first idle downstream connection available. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rproxy</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>downstream connection, otherwise NULL if none are available. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00759">759</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a244f84554906ebc5e0393b530cf4de5c"></a><!-- doxytag: member="downstream.c::downstream_connection_get_rr" ref="a244f84554906ebc5e0393b530cf4de5c" args="(rproxy_t *rproxy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_get_rr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Attempts to find an idle connection using round-robin on configured downstreams. It should be noted that if only 1 downstream is configured, this will fallback to using the RTT load-balancing method. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rproxy</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a downstream connection, NULL if none are avail. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00784">784</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a01dc52dd1fc93603bcedf352c9a9d287"></a><!-- doxytag: member="downstream.c::downstream_connection_init" ref="a01dc52dd1fc93603bcedf352c9a9d287" args="(evbase_t *evbase, downstream_t *downstream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int downstream_connection_init </td>
          <td>(</td>
          <td class="paramtype">evbase_t *&nbsp;</td>
          <td class="paramname"> <em>evbase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdownstream.html">downstream_t</a> *&nbsp;</td>
          <td class="paramname"> <em>downstream</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initializes downstream connections </p>
<p>Creates N downstream connection structures based on the downstream_cfg's connections variable. Each downstream_connection is initially set to down using <a class="el" href="downstream_8c.html#a90c4623093050b6cbf489cdb56081897" title="sets a downstream connection down, shutting down sockets and enabling the retry timer process...">downstream_connection_set_down()</a>. That function will do the work of actually making a connect() attempt.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>evbase</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>downstream</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01225">1225</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab33dc99814365ac5170ca09db6fa9789"></a><!-- doxytag: member="downstream.c::downstream_connection_new" ref="ab33dc99814365ac5170ca09db6fa9789" args="(evbase_t *evbase, downstream_t *downstream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream__c.html">downstream_c_t</a>* downstream_connection_new </td>
          <td>(</td>
          <td class="paramtype">evbase_t *&nbsp;</td>
          <td class="paramname"> <em>evbase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdownstream.html">downstream_t</a> *&nbsp;</td>
          <td class="paramname"> <em>downstream</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>creates a new downstream connection using downstream_t information </p>
<p>Initializes a downstream connection along with creating a retry event timer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>evbase</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>downstream</em>&nbsp;</td><td>the parent downstream_t instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>downstream_c_t </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01285">1285</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae9caabab44d8b22d36dc355c14cfd854"></a><!-- doxytag: member="downstream.c::downstream_connection_readcb" ref="ae9caabab44d8b22d36dc355c14cfd854" args="(evbev_t *bev, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_connection_readcb </td>
          <td>(</td>
          <td class="paramtype">evbev_t *&nbsp;</td>
          <td class="paramname"> <em>bev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>called when data becomes available on a downstream socket and deals with the data as a response of a request. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bev</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01017">1017</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab38cd3fabc18701dfb32185f7cea53c9"></a><!-- doxytag: member="downstream.c::downstream_connection_retry" ref="ab38cd3fabc18701dfb32185f7cea53c9" args="(int sock, short which, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_connection_retry </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&nbsp;</td>
          <td class="paramname"> <em>which</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>called when the retry event timer has been triggered and attempts to reconnect to a downstream in a down state. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>which</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01140">1140</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8ce1ead74e21489465ea26410493af8d"></a><!-- doxytag: member="downstream.c::downstream_connection_set_active" ref="a8ce1ead74e21489465ea26410493af8d" args="(downstream_c_t *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int downstream_connection_set_active </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets a downstream connection to active, signifying it is currently processing another request. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00624">624</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a90c4623093050b6cbf489cdb56081897"></a><!-- doxytag: member="downstream.c::downstream_connection_set_down" ref="a90c4623093050b6cbf489cdb56081897" args="(downstream_c_t *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int downstream_connection_set_down </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets a downstream connection down, shutting down sockets and enabling the retry timer process. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 on error. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00549">549</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a29ff5e004ebcb9a07bea61f6d188d0d5"></a><!-- doxytag: member="downstream.c::downstream_connection_set_idle" ref="a29ff5e004ebcb9a07bea61f6d188d0d5" args="(downstream_c_t *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int downstream_connection_set_idle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownstream__c.html">downstream_c_t</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets a downstream connection to idle and ready to be used. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 on error. </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00481">481</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0fbcfda628857d24c557d68ba1ae2b7c"></a><!-- doxytag: member="downstream.c::downstream_connection_writecb" ref="a0fbcfda628857d24c557d68ba1ae2b7c" args="(evbev_t *bev, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_connection_writecb </td>
          <td>(</td>
          <td class="paramtype">evbev_t *&nbsp;</td>
          <td class="paramname"> <em>bev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="downstream_8c_source.html#l00873">873</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="a35510eba776c5b630b0998cba6c0a16c"></a><!-- doxytag: member="downstream.c::downstream_free" ref="a35510eba776c5b630b0998cba6c0a16c" args="(downstream_t *downstream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downstream_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownstream.html">downstream_t</a> *&nbsp;</td>
          <td class="paramname"> <em>downstream</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>frees all downstream connections and the parent </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>downstream</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01312">1312</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
<a class="anchor" id="af43dc9df06bf91fa47b05dc68c3f1411"></a><!-- doxytag: member="downstream.c::downstream_new" ref="af43dc9df06bf91fa47b05dc68c3f1411" args="(rproxy_t *rproxy, downstream_cfg_t *cfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdownstream.html">downstream_t</a>* downstream_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrproxy.html">rproxy_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rproxy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structdownstream__cfg.html">downstream_cfg_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>allocates a downstream_t parent and initializes the downstream connection queues. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rproxy</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cfg</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>downstream_t on success, NULL on error </dd></dl>

<p>Definition at line <a class="el" href="downstream_8c_source.html#l01352">1352</a> of file <a class="el" href="downstream_8c_source.html">downstream.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Apr 4 2012 22:55:21 for rproxy by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
